@(gameState: models.game.GameState,
        quiz: models.quiz.Quiz,
        question: models.quiz.question.DerivativeQuestion,
        currentAnswer: Option[Either[models.quiz.answer.DerivativeAnswer, models.quiz.answer.DerivativeAnswer]])(implicit user: models.user.User, session: play.api.db.slick.Config.driver.simple.Session)

@import controllers.game.routes.{GamesRequesteeController, GamesController}
@import controllers.game.GameAnswerQuestion
@import helper._
@import com.artclod.play.s
@import views.html.tag._

@mainWithBorder("Answering Question", tag.courseOpLink(gameState.game.course), gameLink(Html("game"), gameState.game)) {

    <h2>You are answering Question for a game with @gameState.game.requestor.n </h2>

    <h4>What is the Derivative of:</h4>

    @mathml.mathmlDisplay(question)

    @for(answerEither <- currentAnswer) {
    <section align="center">
        <h4>
        @answerEither match {
            case Right(answer) => {You answered @mathml.mathmlDisplay(answer) that answer was @mathml.correct(answer.correct)}
            case Left(answerTmp) => {You answered @mathml.mathmlDisplay(answerTmp) Sorry but the system was unable to determine if that answer was correct :( please try another answer}
        }
        </h4>
    </section>
    }

    <section>
        <p>
            Type in your answer, and then hit the submit button @tag.answerWarning()<br>
            @mathml.mathmlEditor("ANSWER", viewsupport.organization.mathMLStr(currentAnswer)) <br>
        </p>
    </section>

    <section>
        @form(GamesRequesteeController.answerQuestion(gameState.game.id, question.id), 'id -> "answerForm", 'class -> "pure-form") {
            <input type="hidden" name="@GameAnswerQuestion.mathML" id="answerMathML">
            <input type="hidden" name="@GameAnswerQuestion.rawStr" id="answerRawStr">
            <input type="button" class="pure-button pure-button-primary" value="Submit" onclick="answerFormSubmit()">
            @gameLink(Html("Back to the Quiz"), gameState.game)
        }
    </section>

    <script>
    var answerFormSubmit = function ( ) {
    if ( ANSWER.valid ) {
    $ ( "#answerMathML" ).val ( ANSWER.mathML ) ;
    $ ( "#answerRawStr" ).val ( ANSWER.rawStr ) ;
    $ ( "#answerForm" ).submit ( ) ;
    } else {
    alert("The answer is not in a valid format so it cannot be submitted")
    }
    }
    </script>

    @* ===== Results ===== *@
    @defining(question.results(user)) { results =>
    @if(results.answers.nonEmpty) {
    <section>
        <h4>You have answered this questions @results.answers.size time@s(results.answers)</h4>
        <ul>
        @for(answer <- results.answers) {
            <li> @mathml.mathmlDisplay(answer) this answer was @mathml.correct(answer.correct) </li>
        }
        </ul>
    </section>
    }
    }

}