@(group: models.organization.assignment.Group)(implicit user: service.User, session: play.api.db.slick.Config.driver.simple.Session)

@import service._
@import views.html.tag._
@import helper._
@import controllers.organization.assignment.routes._
@import controllers.organization.assignment.quiz.routes._
@import controllers.question.derivative.routes._

@defining(group.course){ course =>
@defining(group.section){ section =>
@defining(group.assignment){ assignment =>

@main(assignment.name) {

    <h2>
        Welcome to the information page for the group: @group.name
    </h2>

    for course [ @courseLink(course) ] <br>
    and section [ @sectionLink(section) ] <br>
    and assignment [ @assignmentLink(assignment) ] <br>

    @* ===== Start and end dates ===== *@
    @assignment.startAndEnd match {
        case (Some(start), Some(end)) => {This assignment starts on @datetime(start) and ends on @datetime(end)<br>}
        case (Some(start), None) => {This assignment starts on @datetime(start)<br>}
        case (None, Some(end)) => {This assignment ends on @datetime(end)<br>}
        case (None, None) => {}
    }

    @defining(section.access) { access =>
        @* ===== Group Info ===== *@
        @if(access > Non) {
            @if(group.students.isEmpty) {Currently there are no students in this group} else { the following students are in this group:
                <ul>
                    @for(student <- group.students) {<li> @student.fullName </li>}
                </ul>
            }
        }

        @defining(group.enrolled) { enrolledInThisGroup =>
            @* ===== Joining the Group ===== *@
            @if(access > Non && !enrolledInThisGroup && assignment.enrolled.isEmpty) {
                @form(action = GroupsController.join(course.id, section.id, assignment.id, group.id)) {
                    Join this group: <input type="submit" value="Join">
                }
            }
            @* ===== Quizzes for the group ===== *@
            @if(access > Non && enrolledInThisGroup || access.write) {

                @defining(group.quizzes) { quizzes =>
                    @if(quizzes.isEmpty) {There are no quizzes for this group yet<br>} else {The following quizzes are in this group:<br>
                        <table>
                        <tr><th>Quiz</th><th># Questions</th><th># Correct</th><th># Attempted</th></tr>
                        @for(quiz <- group.quizzes) {
                            @defining(quiz.results(user)){ results =>
                            <tr><td>[ @groupQuizLink(group, quiz) ]</td> <td>@results.numQuestions</td> <td>@results.numCorrect</td> <td>@results.numAttempted</td> </tr>
                            }
                        }
                        </table>
                    }
                }

                @defining(group.quizFor(user)) { quizOp =>
                    @for(quiz <- quizOp) {
                        You created the quiz [ @groupQuizLink(group, quiz) ] <br>
                    } @if(quizOp.isEmpty) {
                        [ <a href="@GroupQuizzesController.add(course.id, section.id, assignment.id, group.id)">Create your Quiz for this group</a> ] <br>
                    }
                }
            }
        }
    }

}

}
}
}
