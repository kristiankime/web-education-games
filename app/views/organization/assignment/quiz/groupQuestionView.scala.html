@(group: models.organization.assignment.Group,
  quiz: models.question.derivative.Quiz,
  question: models.question.derivative.Question,
  currentAnswer: Option[Either[models.question.derivative.Answer, models.question.derivative.Answer]])(implicit user: service.User, session: play.api.db.slick.Config.driver.simple.Session)

@import helper._
@import controllers.organization.assignment.quiz.routes.GroupQuizzesController
@import controllers.organization.assignment.quiz.routes.GroupQuestionsController
@import controllers.organization.assignment.quiz.routes.GroupAnswersController
@import controllers.question.derivative.AnswerForm
@import com.artclod.play.s
@import views.html.tag._

@defining(quiz.access){ access =>
@defining(group.course){ course =>
@defining(group.section){ section =>
@defining(group.assignment){ assignment =>

@main("Question Page") {

    <h2>Welcome to a question page for quiz: @quiz.name </h2>

    This quiz will be for the course [ @courseLink(course) ] <br>
    in the section [ @sectionLink(section) ] <br>
    for the assignment [ @assignmentLink(assignment) ] <br>
    and the group [ @groupLink(group) ] <br>

    Back to the quiz [ <a href="@GroupQuizzesController.view(course.id, section.id, assignment.id, group.id, quiz.id)">@quiz.name</a> ] <br>

    <h2>What is the Derivative of</h2> @math.mathmlContent(question)

    @for(answerEither <- currentAnswer) {
        <section align="center">
            <h4>
            @answerEither match {
                case Right(answer) => {You answered @math.mathmlContent(answer) that answer was @math.correct(answer.correct)}
                case Left(answerTmp) => {You answered @math.mathmlContent(answerTmp) Sorry but the system was unable to determine if that answer was correct :( please try another answer}
            }
            </h4>
        </section>
    }

    <section>
        <p>
            Type in your answer, and then hit the submit button <br>
            @math.mathmlEditor("ANSWER", viewsupport.organization.mathMLStr(currentAnswer)) <br>
        </p>
    </section>

    <section>
    @form(GroupAnswersController.create(course.id, section.id, assignment.id, group.id, quiz.id, question.id), 'id -> "answerForm") {
        <input type="hidden" name="@AnswerForm.mathML" id="answerMathML">
        <input type="hidden" name="@AnswerForm.rawStr" id="answerRawStr">
        <input type="button" value="Submit" onclick="answerFormSubmit()">
        }
    </section>

    <script>
    var answerFormSubmit = function ( ) {
        if ( ANSWER.valid ) {
            $ ( "#answerMathML" ).val ( ANSWER.mathML ) ;
            $ ( "#answerRawStr" ).val ( ANSWER.rawStr ) ;
            $ ( "#answerForm" ).submit ( ) ;
        } else {
            alert("The answer is not in a valid format so it cannot be submitted")
        }
    }
    </script>

    @defining(quiz.nextQuestion(question)){ nextOp =>
    @for(next <- nextOp) {
        Go to the [<a href="@GroupQuestionsController.view(course.id, section.id, assignment.id, group.id, quiz.id, next.id)">next question</a>] <br>
    }
    @if(nextOp.isEmpty) {
        There are no more questions in this quiz back to the assignment [ @assignmentLink(assignment) ]
    }
    }

    @defining(question.results(user)) { results =>
    @if(results.answers.nonEmpty) {
        <section>
            <h4>You have answered this questions @results.answers.size time@s(results.answers)</h4>
            <ul>
            @for(answer <- results.answers) {
                <li> @math.mathmlContent(answer) this answer was @math.correct(answer.correct) </li>
            }
            </ul>
        </section>
    }
    }

    @if(access.write) {
    @defining(question.answersAndOwners) { allAnswers =>
        <section>
            <h4>There have been @allAnswers.size Answer@s(allAnswers) to this question</h4>
            <table>
                <tr> <th> Last Name </th> <th> First Name </th> <th> Email </th> <th> Answer </th> <th> Correct </th> <th>
                    Time </th> </tr>
                @for(answer <- allAnswers) {
                    <tr>
                        <td> @answer._2.lastName </td>
                        <td> @answer._2.firstName </td>
                        <td> @answer._2.email </td>
                        <td> @math.mathmlContent(answer._1) </td>
                        <td> @math.correct(answer._1.correct) </td>
                        <td> @datetime(answer._1.creationDate) </td>
                    </tr>
                }
            </table>
        </section>
    }
    }
}

}
}
}
}