@(group: models.organization.assignment.Group, quiz: models.question.derivative.Quiz)(implicit user: service.User, session: play.api.db.slick.Config.driver.simple.Session)

@import helper._
@import views.html.tag._
@import controllers.organization.assignment.quiz.routes.GroupQuizzesController
@import controllers.organization.assignment.quiz.routes.GroupQuestionsController
@import controllers.organization.assignment.quiz.QuizForm
@import controllers.organization.assignment.quiz.QuestionForm

@defining(quiz.access){ access =>
@defining(group.course){ course =>
@defining(group.section){ section =>
@defining(group.assignment){ assignment =>

@main("Quiz " + quiz.name) {

    <h2>Welcome to the page for quiz: @quiz.name </h2>

    This quiz is for the course [ @courseLink(course) ] <br>
    in the section [ @sectionLink(section) ] <br>
    for the assignment [ @assignmentLink(assignment) ] <br>
    and the group [ @groupLink(group) ] <br>

    @if(access.write){
    	@form(GroupQuizzesController.rename(course.id, section.id, assignment.id, group.id, quiz.id), 'class -> "inline-block") {
     		To rename type a new name here <input type="text" name="@QuizForm.name" value="@quiz.name">
    		and click <input type="submit" value="rename" > 
    	} 
    }

    @if(access.write){
    @defining(quiz.groupResults){ groupData =>

    <h4>There are @groupData.results.size Question(s) in the quiz you created</h4>
    <table>
        <th> Question </th> <th> details </th> <th> For Who </th> <th> How did they do </th> <th> Difficulty </th> <th> Teaching Score </th> <th> Remove </th>
        @for(result <- groupData.results){
        @defining(result.question.forWho){ forWho =>
            <tr>
                <td> @mathml.mathmlContent(result.question) </td>
            	<td> <a href="@GroupQuestionsController.view(course.id, section.id, assignment.id, group.id, quiz.id, result.question.id)">view question </a> </td>
                <td> @forWho.map(_.fullName) </td>
                <td> @result.status @forWho.map(result.question.results(_).status) </td>
                <td> @result.question.difficulty.map(percentDisplay(_)) </td>
                <td> @result.teacherScore.map(percentDisplay(_)) </td>
                <td> @form(GroupQuestionsController.remove(course.id, section.id, assignment.id, group.id, quiz.id, result.question.id), 'class -> "inline-block") { <input type="submit" value="remove" > } </td>
            </tr>
        }
        }
    </table>
    @for(score <- groupData.teacherScore){Your teaching score for the quiz was @percentDisplay(score)}

    }
    } else {
    @defining(quiz.results(user)){ results =>

    <h4>There are @results.numQuestions Question(s) in the quiz</h4>
    <table>
        <th>Question #</th> <th>Status</th> <th># Attempts </th> <th># Before Correct </th> <th> Score </th>
        @for(questionAndIndex <- results.results.zipWithIndex){
            <tr>
                <td> <a href="@GroupQuestionsController.view(course.id, section.id, assignment.id, group.id, quiz.id, questionAndIndex._1.question.id)">view question @questionAndIndex._2 </a> </td>
                <td> @views.html.question.status(questionAndIndex._1.status) </td>
                <td> @questionAndIndex._1.numAttempts </td>
                <td> @questionAndIndex._1.numAttemptsToCorrect </td>
                <td> @questionAndIndex._1.score.map(percentDisplay(_)) </td>
            </tr>
        }
    </table>
    @for(score <- results.score){Your score for the quiz was @percentDisplay(score)}

    }
    }
    
    @if(access.write){
    @defining(quiz.needQuestionsFor) { needQuestionsFor =>

        <h4>Add a new Question</h4>

        @if(needQuestionsFor.isEmpty){
            You have already created a Questions for all of the students in this group<br>
        } else {

        <h5>Please add a questions for </h5>
	    <p>
			Type in an equation and press "Save Question": <br>
            @mathml.mathmlEditor(editorName="QUESTION")
		</p>
	
	    @form(GroupQuestionsController.create(course.id, section.id, assignment.id, group.id, quiz.id), 'id -> "derivativeqForm" ) {
	    	<input type="hidden" name="@QuestionForm.mathML" id="derivativeQuestionMathML">
	    	<input type="hidden" name="@QuestionForm.rawStr" id="derivativeQuestionRawStr">
            <select name="@QuestionForm.targetUser">
                <option value="@needQuestionsFor.head.id.v" selected>@needQuestionsFor.head.fullName</option>
                @for(needQuestionFor <- needQuestionsFor.tail) {<option value="@needQuestionFor.id.v">@needQuestionFor.fullName</option>}
            </select>
	    	<input type="button" value="Save Question" onclick="formSubmit()">
	    }
	    
	    <script>
		formSubmit = function() {
			if(QUESTION.valid){
				$("#derivativeQuestionMathML").val(QUESTION.mathML);
				$("#derivativeQuestionRawStr").val(QUESTION.rawStr);
				$("#derivativeqForm").submit();
			} else {
                alert("The answer is not in a valid format so it cannot be submitted")
            }
	    }
	    </script>
        }
    }
    }
    @if(course.access.write){@views.html.tag.sectionResults(course.sectionResults(quiz))}
}

}
}
}
}
