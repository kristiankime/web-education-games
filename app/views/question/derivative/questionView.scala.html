@(access: service.Access,
        where: Either[models.organization.Course, models.organization.assignment.Group],
        quiz: models.question.derivative.Quiz,
        results: viewsupport.question.derivative.QuestionResults,
        currentAnswer: Option[Either[models.question.derivative.AnswerTmp, models.question.derivative.Answer]],
        nextQuestion: Option[models.question.derivative.Question],
        allAnswers: List[(models.question.derivative.Answer, service.User)])(implicit user: service.User, session: scala.slick.session.Session)

@import com.artclod.util._
@import helper._
@import controllers.organization.routes._
@import controllers.organization.assignment.routes.GroupsController
@import controllers.question.derivative.AnswerForm
@import controllers.question.derivative.routes._
@import com.artclod.play.s
@import views.html.tag._
@import models.support._

@defining(models.organization.courseFrom(where)){ course =>

@main("Question Page") {

    <h2>Welcome to a question page for quiz: @quiz.name </h2>

    This is a quiz for the course [ @courseLink(course) ] <br>

    @for(group <- where.rightOp){ And the group [ <a href="@GroupsController.view(course.id, group.sectionId, group.assignmentId, group.id)"> @group.name </a> ] <br> }

    Back to the quiz [ <a href="@QuizzesController.view(quiz.id, where.leftOp(_.id), where.rightOp(_.id))">@quiz.name</a> ] <br>

    <h2>What is the Derivative of</h2> @math.mathmlContent(results.question)

    @for(answerEither <- currentAnswer) {
        <section align="center">
            <h4>
            @answerEither match {
                case Right(answer) => {You answered @math.mathmlContent(answer) that answer was @math.correct(answer.correct)}
                case Left(answerTmp) => {You answered @math.mathmlContent(answerTmp) Sorry but the system was unable to determine if that answer was correct :( please try another answer}
            }
            </h4>
        </section>
    }

    <section>
        <p>
            Type in your answer, and then hit the submit button <br>
            @math.mathmlEditor("ANSWER", viewsupport.organization.mathMLStr(currentAnswer)) <br>
        </p>
    </section>

    <section>
    @form(AnswersController.create(quiz.id, results.question.id, where.leftOp(_.id), where.rightOp(_.id)), 'id -> "answerForm") {
        <input type="hidden" name="@AnswerForm.mathML" id="answerMathML">
        <input type="hidden" name="@AnswerForm.rawStr" id="answerRawStr">
        <input type="button" value="Submit" onclick="answerFormSubmit()">
        }
    </section>

    <script>
    var answerFormSubmit = function ( ) {
        if ( ANSWER.valid ) {
            $ ( "#answerMathML" ).val ( ANSWER.mathML ) ;
            $ ( "#answerRawStr" ).val ( ANSWER.rawStr ) ;
            $ ( "#answerForm" ).submit ( ) ;
        } else {
            alert("The answer is not in a valid format so it cannot be submitted")
        }
    }
    </script>

    @for(next <- nextQuestion) {
        Go to the [<a href="@QuestionsController.view(quiz.id, next.id, where.leftOp(_.id), where.rightOp(_.id))">next question</a>] <br>
    }

    @if(results.answers.nonEmpty) {
        <section>
            <h4>You have answered this questions @results.answers.size time@s(results.answers)</h4>
            <ul>
            @for(answer <- results.answers) {
                <li> @math.mathmlContent(answer) this answer was @math.correct(answer.correct) </li>
            }
            </ul>
        </section>
    }

    @if(access.write) {
        <section>
            <h4>There have been @allAnswers.size Answer@s(allAnswers) to this question</h4>
            <table>
                <tr> <th> Last Name </th> <th> First Name </th> <th> Email </th> <th> Answer </th> <th> Correct </th> <th>
                    Time </th> </tr>
                @for(answer <- allAnswers) {
                    <tr>
                        <td> @answer._2.lastName </td>
                        <td> @answer._2.firstName </td>
                        <td> @answer._2.email </td>
                        <td> @math.mathmlContent(answer._1) </td>
                        <td> @math.correct(answer._1.correct) </td>
                        <td> @datetime(answer._1.creationDate) </td>
                    </tr>
                }
            </table>
        </section>
    }
}

}