@(course: models.organization.Course,
  quiz: models.question.derivative.Quiz,
  results: viewsupport.question.derivative.QuestionResults,
  currentAnswer: Option[Either[models.question.derivative.Answer, models.question.derivative.Answer]])(implicit user: service.User, session: play.api.db.slick.Config.driver.simple.Session)

@import helper._
@import controllers.question.derivative.AnswerForm
@import controllers.question.derivative.routes._
@import com.artclod.play.s
@import views.html.tag._

@defining(quiz.access){ access =>

@main("Question Page") {
    <h2>Welcome to a question page for quiz: @quiz.name </h2>

    This is a quiz for the course [ @courseLink(course) ] <br>
    Back to the quiz [ @courseQuizLink(course, quiz) ] <br>

    <h2>What is the Derivative of</h2> @mathml.mathmlContent(results.question)

    @for(answerEither <- currentAnswer) {
        <section align="center">
            <h4>
            @answerEither match {
                case Right(answer) => {You answered @mathml.mathmlContent(answer) that answer was @mathml.correct(answer.correct)}
                case Left(answerTmp) => {You answered @mathml.mathmlContent(answerTmp) Sorry but the system was unable to determine if that answer was correct :( please try another answer}
            }
            </h4>
        </section>
    }

    <section>
        <p>
            Type in your answer, and then hit the submit button <br>
            @mathml.mathmlEditor("ANSWER", viewsupport.organization.mathMLStr(currentAnswer)) <br>
        </p>
    </section>

    <section>
    @form(AnswersController.create(quiz.id, results.question.id, course.id), 'id -> "answerForm") {
        <input type="hidden" name="@AnswerForm.mathML" id="answerMathML">
        <input type="hidden" name="@AnswerForm.rawStr" id="answerRawStr">
        <input type="button" value="Submit" onclick="answerFormSubmit()">
        }
    </section>

    <script>
    var answerFormSubmit = function ( ) {
        if ( ANSWER.valid ) {
            $ ( "#answerMathML" ).val ( ANSWER.mathML ) ;
            $ ( "#answerRawStr" ).val ( ANSWER.rawStr ) ;
            $ ( "#answerForm" ).submit ( ) ;
        } else {
            alert("The answer is not in a valid format so it cannot be submitted")
        }
    }
    </script>

    @* ===== Question Navigation ===== *@
    @defining(quiz.previousQuestion(results.question)){ previousOp =>
        @for(previous <- previousOp) {Go to the [<a href="@QuestionsController.view(quiz.id, previous.id, course.id)">previous question</a>]<br>}
    }

    @defining(quiz.firstUnfinishedQuestion(user)){ unfinishedOp =>
        @for(unfinished <- unfinishedOp) {Go to my first [<a href="@QuestionsController.view(quiz.id, unfinished.question.id, course.id)">unfinished question</a>]<br>}
    }

    @defining(quiz.nextQuestion(results.question)){ nextOp =>
        @for(next <- nextOp) {Go to the [<a href="@QuestionsController.view(quiz.id, next.id, course.id)">next question</a>]}
        @if(nextOp.isEmpty) {This is the last question, back to the quiz [ @courseQuizLink(course, quiz) ]}
    }
    <br>

    @* ===== Results ===== *@
    @if(results.answers.nonEmpty) {
        <section>
            <h4>You have answered this questions @results.answers.size time@s(results.answers)</h4>
            <ul>
            @for(answer <- results.answers) {
                <li> @mathml.mathmlContent(answer) this answer was @mathml.correct(answer.correct) </li>
            }
            </ul>
        </section>
    }

    @if(access.write) {@allAnswers(results.question)}
}

}