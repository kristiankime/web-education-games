@(access: service.Access,
	course: models.organization.Course,
    quiz: models.question.derivative.Quiz)(implicit user: service.User, session: play.api.db.slick.Config.driver.simple.Session)

@import models.question.derivative.result.QuizResults
@import helper._
@import views.html.tag._
@import controllers.question.derivative.routes.{ QuestionsController, QuizzesController}
@import controllers.question.derivative.{ QuizForm, QuestionForm }
@import models.user.UserPimped

@main("Quiz " + quiz.name, tag.courseLink(course)) {

    <h2>Welcome to the page for quiz: @quiz.name </h2>

    This is a quiz for the course @courseLink(course) <br>

    @if(access.write){
    @form(QuizzesController.rename(course.organizationId, course.id, quiz.id), 'class -> "inline-block") {
        To rename type a new name here <input type="text" name="@QuizForm.name" value="@quiz.name">
        and click <input type="submit" value="rename" >
    }
    }

    @defining(quiz.results(user)){ quizResults =>
    <h4>There are @quizResults.questions.size Question(s) in the quiz</h4>

    <table>
    	<th>Question</th> <th>Details</th> <th>Status</th> @if(access.write){ <th> Remove </th> }
        @for(result <- quizResults.results){
        <tr>
            <td> @mathml.mathmlContent(result.question) </td>
            <td> <a href="@QuestionsController.view(course.organizationId, course.id, quiz.id, result.question.id)">view</a> </td>
            <td> @views.html.question.status(result.status) </td>
            @if(access.write){ <td> @form(QuestionsController.remove(course.organizationId, course.id, quiz.id, result.question.id), 'class -> "inline-block") { <input type="submit" value="remove" > } </td> }
        </tr>
        }
    </table>
    }

    @if(access.write){
    <section>
        <h4>Add a new Question</h4>

        <p>
            Enter a function (of x) to differentiate. When you are done hit "Save Question": <br>
            @mathml.mathmlEditor(editorName = "QUESTION", characterLimitOp=Some(40))
        </p>

        @form(QuestionsController.create(course.organizationId, course.id, quiz.id), 'id -> "derivativeqForm" ) {
            <input type="hidden" name="@QuestionForm.mathML" id="derivativeQuestionMathML">
            <input type="hidden" name="@QuestionForm.rawStr" id="derivativeQuestionRawStr">
            <input type="button" value="Save Question" onclick="formSubmit()">
        }

        <script>
        formSubmit = function() {
            if(QUESTION.valid){
                $("#derivativeQuestionMathML").val(QUESTION.mathML);
                $("#derivativeQuestionRawStr").val(QUESTION.rawStr);
                $("#derivativeqForm").submit();
            } else {
                alert("Sorry we couldn't create a questions since we couldn't understand your equation. Please try fixing it and resubmitting. There is a red astrix next to the input box if the system can't understand what you typed.")
            }
        }
        </script>
    </section>

    @defining(quiz.results(course)) { quizResults =>
    <section>
        <h4>Summary of student results</h4>
        <ul>
        @for(result <- quizResults) {
            <li> @{result.student.name}'s score was @tag.percentOp(result.score)</li>
        }
        </ul>
    </section>
    }

    }

}
