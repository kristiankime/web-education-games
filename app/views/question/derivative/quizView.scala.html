@(access: service.Access,
	course: models.organization.Course,
    quiz: models.question.derivative.Quiz)(implicit user: service.User, session: play.api.db.slick.Config.driver.simple.Session)

@import helper._
@import controllers.question.derivative.routes.{ QuestionsController, QuizzesController}
@import controllers.question.derivative.{ QuizForm, QuestionForm }
@import models.user.UserPimped
@import com.artclod.play.{are, s}

@mainWithBorder("Quiz " + quiz.name, tag.courseLink(course)) {

    <h2>Welcome to the page for quiz: @quiz.name </h2>

    @if(access.write){
    @form(QuizzesController.rename(course.organizationId, course.id, quiz.id), 'class -> "pure-form") {
        To rename type a new name here <input type="text" name="@QuizForm.name" value="@quiz.name">
        and click <input class="pure-button" type="submit" value="rename" >
    }
    }

    @defining(quiz.results(user)){ results =>
    @defining(results.questions){ questions =>

    <h4>There @are(questions) @questions.size Question@s(questions) in the quiz @tag.icon("icon-help", 'data_ot -> "Click a question to answer it")</h4>

    <table class="pure-table pure-table-striped">
    	<th>Question</th> <th>Status</th> @if(access.write){ <th> Remove </th> }
        @for(result <- results.results){
        <tr>
            <td> <a class="pure-button" href="@QuestionsController.view(course.organizationId, course.id, quiz.id, result.question.id)"> @mathml.mathmlContent(result.question) </a></td>
            <td> @views.html.question.status(result.status) </td>
            @if(access.write){ <td> @form(QuestionsController.remove(course.organizationId, course.id, quiz.id, result.question.id), 'class -> "inline-block") { <input class="pure-button" type="submit" value="remove" > } </td> }
        </tr>
        }
    </table>
    }
    }

    @if(access.write){
    <section>
        <h4>Add a new Question</h4>

        <p>
            Enter a function (of x) to differentiate. When you are done hit "Save Question": <br>
            @mathml.mathmlEditor(editorName = "QUESTION", characterLimitOp=Some(40))
        </p>

        @form(QuestionsController.create(course.organizationId, course.id, quiz.id), 'id -> "derivativeqForm", 'class -> "pure-form") {
            <input type="hidden" name="@QuestionForm.mathML" id="derivativeQuestionMathML">
            <input type="hidden" name="@QuestionForm.rawStr" id="derivativeQuestionRawStr">
            <input type="button" class="pure-button" value="Save Question" onclick="formSubmit()">
        }

        <script>
        formSubmit = function() {
            if(QUESTION.valid){
                $("#derivativeQuestionMathML").val(QUESTION.mathML);
                $("#derivativeQuestionRawStr").val(QUESTION.rawStr);
                $("#derivativeqForm").submit();
            } else {
                alert("Sorry we couldn't create a questions since we couldn't understand your equation. Please try changing it and resubmitting. There is a red icon next to the input box if the system can't understand what you typed.")
            }
        }
        </script>
    </section>

    @defining(quiz.results(course)) { quizResults =>
    <section>
        <h4>Summary of student results</h4>
        <ul>
        @for(result <- quizResults) {
            <li> @{result.student.name}'s score was @tag.percentOp(result.score)</li>
        }
        </ul>
    </section>
    }

    }

}
