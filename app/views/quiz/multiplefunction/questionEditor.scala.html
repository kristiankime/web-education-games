@(action: play.api.mvc.Call, mfForm: Form[controllers.quiz.multiplefunction.MultipleFunctionQuestionForm], successCallback : List[String] = List(), infoOp: Option[play.api.templates.Html] = None)(implicit user: models.user.User, session: play.api.db.slick.Config.driver.simple.Session)

@import helper._
@import controllers.quiz.multiplefunction.{MultipleFunctionQuestionForm => MF }
@import com.artclod.play.FormEnhanced
@import controllers.MathController
@import com.artclod.mathml.MathMLEq.tightRange

@defining(5){ numOp : Int =>

<section>
    Enter a description of the problem, as well as descriptions for answers options. Then mark the correct answer and submit. <br>

    @if(mfForm.hasErrors){ @for(error <- mfForm.errors){<span class="form-error"> Error: @error.message </span><br>} }
    @if(mfForm.hasMessage(MF.explanationInvalid)){<span class="form-error"> Sorry we were unable to create your question since the explanation was not valid markup. </span><br>}

    @form(action, 'id -> "multipleFunctionQuestionForm", 'class -> "pure-form") {
        <fieldset>

            <h4>Short Description</h4>
            <input id="@MF.description" name="@MF.description" type="text" size="40" @for(d <- mfForm.dataFor(MF.description)){value="@d"}/>

            <h4>Explanation</h4>
            <p>
            @tag.markupEditor(MF.explanation, mfForm.dataFor(MF.explanation))
            </p>

            <h4>Answer Options</h4>
            <table class="pure-table pure-table-striped">
                <tr> <th> Option </th> <th> Details </th> <th> Correct </th>  </tr> @* TODO on error keep selection *@
                @for(i <- 0 to numOp) {
                    <tr>
                        <td> Option @{i + 1} </td>
                        <td> @tag.markupEditor(MF.options + "[" + i + "]", mfForm.dataFor(MF.options + "[" + i + "]"), 4, 30) </td>
                        <td> @mathml.mathmlEditor(MF.functions + i, mfForm.dataFor(MF.functions + i)) </td>
                    </tr>
                }
            </table>

            <h4>Difficulty</h4>
            <input type="number" min="1" max="300" step="1" @if(mfForm.dataFor(MF.description).isEmpty){value="1"}else{value="@mfForm.dataFor(MF.description).get"} size="6" name="@MF.difficulty" id="@MF.difficulty"> <br/><br/>

            @for(i <- (0 to numOp)) {
                <input type="hidden" name='@{MF.functions + "[" + i + "]"}' id="@{MF.functions + i}MathML"> <input type="hidden" name='@{MF.functionsStr + "[" + i + "]"}' id="@{MF.functions + i}RawStr">}

            <input type="button" class="pure-button" value="Save Question" onclick="MULTIPLE_FUNCTION_QUESTION_FORM.formSubmit()">
        </fieldset>
    }

    @for(info <- infoOp){ @info }


    <script>
        var MULTIPLE_FUNCTION_QUESTION_FORM = {}
        MULTIPLE_FUNCTION_QUESTION_FORM.formSubmit = function() {
            var ready = true;
            var hasOption = false;

            var optionText = "";
            @for(i <- (0 to numOp)) {
            optionText = $("#@{MF.options + "_" + i + "_"}").val()
            if(optionText !== "" && @{MF.functions + i}.valid) {
                $("#@{MF.functions + i}MathML").val(@{MF.functions + i}.mathML);
                $("#@{MF.functions + i}RawStr").val(@{MF.functions + i}.rawStr);
                hasOption = true;
            } else if(optionText !== "" && !@{MF.functions + i}.valid) {
                ready = false;
            }
            }

            if(ready & hasOption) {
                $("#multipleFunctionQuestionForm").submit();
            } else {
                ready = false;
                hasOption = false;
                alert("Sorry we couldn't create your problem. There needs to be an explanation and at least one option. If there is a red icon next to a function input box the system can't understand what you typed.");
            }
        }
    </script>
</section>
}